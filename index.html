<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ROAD TO TOYROCK INVASION</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --bg1:#0a0a1a;
  --bg2:#1a0a2e;
  --gold:#FFD700;
  --card:rgba(255,255,255,.08);
}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  color:#fff;
}
header{
  text-align:center;
  padding:30px 10px;
}
h1{margin:0;font-size:1.8rem;}
.countdown{
  font-size:1.1rem;
  color:var(--gold);
  margin-top:8px;
}
.tabs{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:20px 0;
}
.tab{
  padding:8px 14px;
  border-radius:999px;
  background:var(--card);
  cursor:pointer;
}
.tab.active{
  background:var(--gold);
  color:#000;
}
section{display:none;padding:0 10px 40px;}
section.active{display:block;}
.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  margin:12px auto;
  max-width:900px;
}
.album h3{
  margin:8px 0;
}
.song{
  padding:6px 10px;
  border-radius:8px;
  margin:4px 0;
  background:rgba(255,255,255,.1);
  cursor:pointer;
}
.song:hover{background:rgba(255,255,255,.2);}
.song.selected{background:var(--gold);color:#000;}
#setlist li{
  list-style:none;
  padding:6px;
  margin:4px 0;
  background:rgba(255,255,255,.12);
  border-radius:6px;
  cursor:grab;
}
button{
  background:var(--gold);
  border:none;
  border-radius:999px;
  padding:8px 14px;
  cursor:pointer;
}
button:disabled{
  opacity:.5;
  cursor:not-allowed;
}
footer{
  text-align:center;
  font-size:.8rem;
  opacity:.7;
  padding-bottom:20px;
}
</style>
</head>
<body>

<header>
  <h1>ROAD TO TOYROCK INVASION</h1>
  <div class="countdown" id="countdown"></div>
</header>

<div class="tabs">
  <div class="tab active" data-tab="vote">投票</div>
  <div class="tab" data-tab="my">マイセトリ</div>
  <div class="tab" data-tab="rank">ランキング</div>
</div>

<section id="vote" class="active"></section>

<section id="my">
  <div class="card">
    <p>ユーザー名：
      <input id="username">
    </p>
    <p>選択曲数：<span id="count">0</span>/20</p>
    <ul id="setlist"></ul>
    <button id="csv">CSV出力</button>
    <button id="share">Xで共有</button>
  </div>
</section>

<section id="rank">
  <div class="card" id="ranking"></div>
</section>

<footer>© toybee fan project</footer>

<script>
const DEADLINE=new Date("2025-03-22T18:00:00+09:00");
const ALBUMS=[
{name:"THE EARLY TOYBEE",color:"#FFD700",songs:["全米は泣かない","それゆけ!夢みるゾンビーズ!!","Flight Music","電脳ヴィジランテ","黎明グッドルーザー","あらしのよるに","いなせ","あほんだらいふ"]},
{name:"REVIVAL",color:"#8B5CF6",songs:["惑星ダブリス","Super Imagination","ワンタイムラヴァー","風知らぬひと","フロムアンダーランド","Teenage Black","シーラカンスと文学"]},
{name:"LOOKBACK TO THE FUTURE",color:"#06B6D4",songs:["LOOKBACK","Golden Age","ステルオンナ","道化師のラブソング","ライド・アンド・ライブ","S.Y.S -Save Your Souls-","TO THE FUTURE"]},
{name:"TOYROCK INVASION",color:"#EF4444",songs:["TOY ROCK -TOYBEEのテーマ-","シモキタ・モーニング・ブルース","CAT GIRL","Jonnie's Rock'n'Roll Lamp","Playlist in your Heart"]},
{name:"Singles",color:"#F59E0B",songs:["ひとつだけ","ハナマル"]}
];

const voteSec=document.getElementById("vote");
const setlist=document.getElementById("setlist");
const countSpan=document.getElementById("count");
const rankingDiv=document.getElementById("ranking");

let my=new Set(JSON.parse(localStorage.getItem("my")||"[]"));
let votes=JSON.parse(localStorage.getItem("votes")||"{}");

function renderVote(){
  voteSec.innerHTML="";
  ALBUMS.forEach(a=>{
    const c=document.createElement("div");
    c.className="card album";
    c.innerHTML=`<h3 style="color:${a.color}">${a.name}</h3>`;
    a.songs.forEach(s=>{
      const d=document.createElement("div");
      d.className="song"+(my.has(s)?" selected":"");
      d.textContent=s;
      d.onclick=()=>toggle(s);
      c.appendChild(d);
    });
    voteSec.appendChild(c);
  });
}
function toggle(song){
  if(Date.now()>DEADLINE)return;
  if(my.has(song))my.delete(song);
  else{
    if(my.size>=20)return alert("20曲までです");
    my.add(song);
  }
  localStorage.setItem("my",JSON.stringify([...my]));
  renderAll();
}
function renderMy(){
  setlist.innerHTML="";
  [...my].forEach(s=>{
    const li=document.createElement("li");
    li.textContent=s;
    setlist.appendChild(li);
  });
  countSpan.textContent=my.size;
}
function renderRank(){
  rankingDiv.innerHTML="";
  const arr=Object.entries(votes).sort((a,b)=>b[1]-a[1]);
  arr.forEach(([s,c])=>{
    const p=document.createElement("p");
    p.textContent=`${s}：${c}`;
    rankingDiv.appendChild(p);
  });
}
function renderAll(){
  renderVote();renderMy();renderRank();
}
renderAll();

document.querySelectorAll(".tab").forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll("section").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    document.getElementById(t.dataset.tab).classList.add("active");
  };
});

setInterval(()=>{
  const d=DEADLINE-new Date();
  document.getElementById("countdown").textContent=
    d>0?`締切まで ${Math.floor(d/3600000)}時間`:"締め切りました";
},1000);
</script>
</body>
</html>
