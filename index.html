<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ROAD TO TOYROCK INVASION</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0f172a;
  --card:#1e1b2e;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#facc15;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:var(--text);
}
header{
  text-align:center;
  padding:40px 16px;
}
h1{margin:0;font-size:36px}
#countdown{font-size:26px;margin-top:12px}
.desc{max-width:900px;margin:20px auto;color:var(--muted);font-size:14px}

main{
  display:flex;
  gap:16px;
  padding:24px;
}
section{
  background:var(--card);
  border-radius:16px;
  padding:20px;
  flex:1;
}
h2{margin-top:0}

input[type=text]{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-bottom:12px;
}

.album{margin-bottom:10px}
.album summary{
  cursor:pointer;
  font-weight:700;
  margin-bottom:6px;
}

/* ★ 安定レイアウト */
.song{
  display:grid;
  grid-template-columns: 24px 1fr;
  gap:10px;
  padding:6px 4px;
  align-items:start;
}
.song span{
  line-height:1.5;
  word-break:break-word;
}

button{
  margin-top:12px;
  background:var(--accent);
  border:none;
  border-radius:999px;
  padding:8px 14px;
  font-weight:700;
  cursor:pointer;
}
button.secondary{
  background:#334155;
  color:#fff;
}

small{color:var(--muted)}
ul{padding-left:18px}

@media(max-width:900px){
  main{flex-direction:column}
}
</style>
</head>

<body>

<header>
  <h1>ROAD TO TOYROCK INVASION</h1>
  <div id="countdown"></div>
  <div class="desc">
    このページはロックバンドtoybeeの2026/3/22(日)＠恵比寿リキッドルーム ワンマンライブの成功を祈念して、toybeeファンが作成したものです。<br>
    ※toybee公式とは関係ありませんのでご留意ください。
    <br><br>
    ・1日1人5票まで<br>
    ・マイセトリ最大20曲<br>
    ・ランキングは全員の累積
    <br><br>
    <small>※ 現在はテストモード（local保存）</small>
  </div>
</header>

<main>

<!-- 投票 -->
<section>
<h2>① 投票（最大5曲）</h2>
<input id="nickname" type="text" placeholder="ニックネーム">

<div id="songList"></div>

<button onclick="vote()">テスト投票</button>
<button class="secondary" onclick="resetTest()">テストデータ全消去</button>

<div id="voteMsg"></div>
</section>

<!-- ランキング -->
<section>
<h2>② ランキング（テスト）</h2>
<ul id="rank"></ul>
</section>

<!-- マイセトリ -->
<section>
<h2>③ マイセトリ</h2>
<ul id="myset"></ul>
</section>

</main>

<script>
/* ===== 設定 ===== */
const DEADLINE=new Date("2026-03-22T18:00:00+09:00");
const MAX_VOTE=5;

/* ===== 曲データ ===== */
const ALBUMS=[
{name:"THE EARLY TOYBEE",songs:["全米は泣かない","それゆけ!夢みるゾンビーズ!!","Flight Music","電脳ヴィジランテ","黎明グッドルーザー","あらしのよるに","いなせ","あほんだらいふ"]},
{name:"REVIVAL",songs:["惑星ダブリス","Super Imagination","ワンタイムラヴァー","風知らぬひと","フロムアンダーランド","Teenage Black","シーラカンスと文学"]},
{name:"LOOKBACK TO THE FUTURE",songs:["LOOKBACK","Golden Age","ステルオンナ","道化師のラブソング","ライド・アンド・ライブ","S.Y.S -Save Your Souls-","TO THE FUTURE"]},
{name:"TOYROCK INVASION",songs:["TOY ROCK -TOYBEEのテーマ-","シモキタ・モーニング・ブルース","CAT GIRL","Jonnie's Rock'n'Roll Lamp","Playlist in your Heart"]},
{name:"Singles",songs:["ひとつだけ","ハナマル"]}
];

/* ===== カウントダウン ===== */
function tick(){
  const d=DEADLINE-new Date();
  if(d<=0){countdown.textContent="開演しました";return;}
  const s=Math.floor(d/1000);
  countdown.textContent=
    "ライブ開演まであと "+
    String(Math.floor(s/86400)).padStart(2,"0")+":"+
    String(Math.floor(s%86400/3600)).padStart(2,"0")+":"+
    String(Math.floor(s%3600/60)).padStart(2,"0")+":"+
    String(s%60).padStart(2,"0");
}
setInterval(tick,1000);tick();

/* ===== 曲描画 ===== */
const songList=document.getElementById("songList");
ALBUMS.forEach(a=>{
  const d=document.createElement("details");
  d.className="album";
  d.innerHTML=`<summary>${a.name}</summary>`;
  a.songs.forEach(s=>{
    d.innerHTML+=`
      <label class="song">
        <input type="checkbox" value="${s}" onchange="limitCheck()">
        <span>${s}</span>
      </label>`;
  });
  songList.appendChild(d);
});

/* ===== 制限 ===== */
function limitCheck(){
  const c=[...document.querySelectorAll("input[type=checkbox]:checked")];
  if(c.length>MAX_VOTE){
    c[c.length-1].checked=false;
    alert("最大5曲までです");
  }
}

/* ===== テスト投票 ===== */
function vote(){
  const nick=nickname.value.trim();
  if(!nick){alert("ニックネーム必須");return;}

  const selected=[...document.querySelectorAll("input[type=checkbox]:checked")].map(c=>c.value);
  if(!selected.length){alert("曲を選んでください");return;}

  const data=JSON.parse(localStorage.getItem("testVotes")||"{}");
  data[nick]=(data[nick]||[]).concat(selected);
  localStorage.setItem("testVotes",JSON.stringify(data));

  voteMsg.textContent="テスト投票しました";
  render();
}

/* ===== 表示 ===== */
function render(){
  const data=JSON.parse(localStorage.getItem("testVotes")||"{}");
  const counts={};
  const my=[];

  Object.entries(data).forEach(([n,arr])=>{
    arr.forEach(s=>{
      counts[s]=(counts[s]||0)+1;
      my.push(s);
    });
  });

  rank.innerHTML=Object.entries(counts)
    .sort((a,b)=>b[1]-a[1])
    .map(([s,c])=>`<li>${s}：${c}</li>`).join("");

  myset.innerHTML=[...new Set(my)].map(s=>`<li>${s}</li>`).join("");
}
render();

/* ===== リセット ===== */
function resetTest(){
  if(confirm("テストデータを全削除しますか？")){
    localStorage.removeItem("testVotes");
    render();
  }
}
</script>

</body>
</html>
